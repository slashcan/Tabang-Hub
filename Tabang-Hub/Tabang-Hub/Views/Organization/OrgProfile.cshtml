@model Tabang_Hub.Utils.Lists

@{
    ViewBag.Title = "OrgProfile";
    Layout = "~/Views/Shared/_Organization.cshtml";
}

<div class="container">
    <div class="card mb-4">
        <img src="https://via.placeholder.com/1500x400" class="card-img-top" alt="Cover Image" style="height: 400px; object-fit: cover;">
        <div class="card-body">
            <div class="d-flex align-items-center">
                <img src="@Url.Content(Model.OrgInfo.profilePath)" class="rounded-circle border border-light me-3" alt="Profile Image" style="width: 200px; height: 200px;">
                <div>
                    <h2 class="card-title mb-1">@Model.OrgInfo.orgName</h2>
                    <p class="text-muted mb-1">@Model.OrgInfo.orgEmail</p>
                </div>
                <button class="btn btn-primary ms-auto">Edit Profile</button>
            </div>
        </div>
    </div>

    <!-- Static Container 1 -->
    <div class="card mb-4">
        <div class="card-body">
            <h3 class="card-title">About Me</h3>
            <p class="card-text">@Model.OrgInfo.orgDescription</p>
        </div>
    </div>

    <div class="container mt-4 bg-white p-4" style="border-radius: 8px;">
        <h3 class="mb-4 text-center">Ongoing Events</h3>
        <div class="row gy-4" id="ongoingEvents">
            @foreach (var events in Model.getAllOrgEvent)
            {
                if (events.dateStart > DateTime.Now)
                {
                    <div class="col-md-6 event-card">
                        <div class="card shadow-sm h-100" style="background-color: #f8f9fa;">
                            <div class="card-body">
                                <div class="d-flex align-items-center mb-3">
                                    <img src="@Url.Content(Model.OrgInfo.profilePath)" alt="Organization Profile" class="rounded-circle me-2" width="45" height="45">
                                    <div>
                                        <h6 class="mb-0">@Model.OrgInfo.orgName</h6>
                                    </div>
                                </div>
                                <h5 class="card-title mb-2">@events.eventTitle</h5>
                                <p class="card-text text-muted">@events.eventDescription</p>
                                @{
                                    var eventImage = Model.detailsEventImage.FirstOrDefault(img => img.eventId == events.eventId);
                                }
                                <img src="@Url.Content(eventImage?.eventImage != null ? "~/Content/Events/" + eventImage.eventImage : "https://via.placeholder.com/400x250")" class="card-img-bottom rounded" alt="Event Image">
                            </div>
                        </div>
                    </div>
                }
            }
        </div>
        <nav aria-label="Page navigation" class="mt-4">
            <ul class="pagination justify-content-center">
                <li class="page-item">
                    <button class="page-link" onclick="prevPage('ongoingEvents')" aria-label="Previous">
                        <span aria-hidden="true">&laquo;</span>
                    </button>
                </li>
                <li class="page-item">
                    <button class="page-link" onclick="nextPage('ongoingEvents')" aria-label="Next">
                        <span aria-hidden="true">&raquo;</span>
                    </button>
                </li>
            </ul>
        </nav>
    </div>

    <div class="container mt-4 bg-white p-4" style="border-radius: 8px;">
        <h3 class="mb-4 text-center">Upcoming Events</h3>
        <div class="row gy-4" id="upcomingEvents">
            @foreach (var events in Model.getAllOrgEvent)
            {
                if (events.dateStart <= DateTime.Now && events.dateEnd > DateTime.Now)
                {
                    <div class="col-md-6 event-card">
                        <div class="card shadow-sm h-100" style="background-color: #f8f9fa;">
                            <div class="card-body">
                                <div class="d-flex align-items-center mb-3">
                                    <img src="@Url.Content(Model.OrgInfo.profilePath)" alt="Organization Profile" class="rounded-circle me-2" width="45" height="45">
                                    <div>
                                        <h6 class="mb-0">@Model.OrgInfo.orgName</h6>
                                    </div>
                                </div>
                                <h5 class="card-title mb-2">@events.eventTitle</h5>
                                <p class="card-text text-muted">@events.eventDescription</p>
                                @{
                                    var eventImage = Model.detailsEventImage.FirstOrDefault(img => img.eventId == events.eventId);
                                }
                                <img src="@Url.Content(eventImage?.eventImage != null ? "~/Content/Events/" + eventImage.eventImage : "https://via.placeholder.com/400x250")" class="card-img-bottom rounded" alt="Event Image">
                            </div>
                        </div>
                    </div>
                }
            }
        </div>
        <nav aria-label="Page navigation" class="mt-4">
            <ul class="pagination justify-content-center">
                <li class="page-item">
                    <button class="page-link" onclick="prevPage('upcomingEvents')" aria-label="Previous">
                        <span aria-hidden="true">&laquo;</span>
                    </button>
                </li>
                <li class="page-item">
                    <button class="page-link" onclick="nextPage('upcomingEvents')" aria-label="Next">
                        <span aria-hidden="true">&raquo;</span>
                    </button>
                </li>
            </ul>
        </nav>
    </div>

    <div class="container mt-4 bg-white p-4" style="border-radius: 8px;">
        <h3 class="mb-4 text-center">Done Events</h3>
        <div class="row gy-4" id="doneEvents">
            @foreach (var events in Model.getAllOrgEvent)
            {
                if (events.dateEnd < DateTime.Now)
                {
                    <div class="col-md-6 event-card">
                        <div class="card shadow-sm h-100" style="background-color: #f8f9fa;">
                            <div class="card-body">
                                <div class="d-flex align-items-center mb-3">
                                    <img src="@Url.Content(Model.OrgInfo.profilePath)" alt="Organization Profile" class="rounded-circle me-2" width="45" height="45">
                                    <div>
                                        <h6 class="mb-0">@Model.OrgInfo.orgName</h6>
                                    </div>
                                </div>
                                <h5 class="card-title mb-2">@events.eventTitle</h5>
                                <p class="card-text text-muted">@events.eventDescription</p>
                                @{
                                    var eventImage = Model.detailsEventImage.FirstOrDefault(img => img.eventId == events.eventId);
                                }
                                <img src="@Url.Content(eventImage?.eventImage != null ? "~/Content/Events/" + eventImage.eventImage : "https://via.placeholder.com/400x250")" class="card-img-bottom rounded" alt="Event Image">
                            </div>
                        </div>
                    </div>
                }
            }
        </div>
        <nav aria-label="Page navigation" class="mt-4">
            <ul class="pagination justify-content-center">
                <li class="page-item">
                    <button class="page-link" onclick="prevPage('doneEvents')" aria-label="Previous">
                        <span aria-hidden="true">&laquo;</span>
                    </button>
                </li>
                <li class="page-item">
                    <button class="page-link" onclick="nextPage('doneEvents')" aria-label="Next">
                        <span aria-hidden="true">&raquo;</span>
                    </button>
                </li>
            </ul>
        </nav>
    </div>
</div>

<script>
    const pageSize = 4;
    let currentPage = {};

    function showPage(sectionId) {
        if (!currentPage[sectionId]) currentPage[sectionId] = 1;

        const cards = document.querySelectorAll(`#${sectionId} .event-card`);
        const totalPages = Math.ceil(cards.length / pageSize);

        cards.forEach((card, index) => {
            card.style.display = (index >= (currentPage[sectionId] - 1) * pageSize && index < currentPage[sectionId] * pageSize) ? 'block' : 'none';
        });

        document.querySelector(`#${sectionId} .pagination .page-link[aria-label="Previous"]`).parentElement.classList.toggle('disabled', currentPage[sectionId] === 1);
        document.querySelector(`#${sectionId} .pagination .page-link[aria-label="Next"]`).parentElement.classList.toggle('disabled', currentPage[sectionId] === totalPages);
    }

    function nextPage(sectionId) {
        const cards = document.querySelectorAll(`#${sectionId} .event-card`);
        const totalPages = Math.ceil(cards.length / pageSize);
        if (currentPage[sectionId] < totalPages) {
            currentPage[sectionId]++;
            showPage(sectionId);
        }
    }

    function prevPage(sectionId) {
        if (currentPage[sectionId] > 1) {
            currentPage[sectionId]--;
            showPage(sectionId);
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        showPage('ongoingEvents');
        showPage('upcomingEvents');
        showPage('doneEvents');
    });
</script>