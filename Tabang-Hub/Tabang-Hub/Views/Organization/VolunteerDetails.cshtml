@model Tabang_Hub.Utils.Lists

@{
    ViewBag.Title = "VolunteerDetails";
    Layout = "~/Views/Shared/_Organization.cshtml";
}
<link href="~/Content/css2/Profile.css" rel="stylesheet" />

<div class="container mt-5">
    <div class="card">
        <div class="card-body">
            <div class="row">
                <div class="col-md-2 text-center">
                    @foreach (var pic in Model.picture)
                    {
                        <img src="~/UserProfile/@pic.profilePath" id="profilePicPreview" class="rounded-circle img-fluid" alt="Profile Picture">
                    }
                </div>
                @foreach (var VolInfo in Model.volunteersInfo)
                {
                    <div class="col-md-8">
                        <h4>@VolInfo.lName.ToUpper(), @VolInfo.fName.ToUpper()</h4>

                        <p id="address">
                            @VolInfo.street.Substring(0, 1).ToUpper()@VolInfo.street.Substring(1),
                            @VolInfo.city.Substring(0, 1).ToUpper()@VolInfo.city.Substring(1) City,
                            @VolInfo.province.Substring(0, 1).ToUpper()@VolInfo.province.Substring(1)
                        </p>

                        <p class="mb-1"><strong>Contact number: </strong><span id="phone">@VolInfo.phoneNum</span></p>

                        <p class="mb-1"><strong>Email: </strong><span id="email">@VolInfo.UserAccount.email</span></p>

                        <p class="mb-1"><strong>Availability: </strong><span id="availability">@VolInfo.availability</span></p>
                    </div>
                }
            </div>
        </div>
    </div>
    <div class="card mt-3">
        <div class="card-body">
            <div class="row">
                <div class="col-md-5">
                    <h5>About me</h5>
                    @foreach (var aboutVolunteer in Model.volunteersInfo)
                    {
                        <p class="mb-1">
                            <span id="aboutMe">
                                @aboutVolunteer.aboutMe
                            </span>
                        </p>
                    }
                </div>
                <div class="col-md-5">
                    <h5>Skills</h5>
                    <div id="skillsDisplay">
                        @foreach (var UserSkill in Model.volunteersSkills)
                        {
                            var skillName = Model.skills.Where(m => m.skillId == UserSkill.skillId).Select(m => m.skillName).FirstOrDefault();
                            <span style="background-color: mediumseagreen; cursor: pointer" class="skill-badge" data-skill-id="@UserSkill.skillId">
                                @Html.Raw(skillName)
                            </span>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="card mt-3">
        <div class="card-body">
            <div class="row">
                <!-- Volunteer Summary Section -->
                <div class="col-md-5">
                    <h5>Volunteer Summary</h5>
                    <div class="mt-4">
                        @{
                            int? getRate = 0;
                            int count = Model.rating.Count();
                            int calculateRate = 0;

                            if (count > 0)
                            {
                                foreach (var rt in Model.rating.Select(m => m.rate))
                                {
                                    getRate += rt;
                                }
                                calculateRate = getRate.Value / count;
                            }
                        }
                        <div>
                            <span class="rate-number">
                                <span>My Rate: &nbsp;</span>
                                <span style="color: #FFA500"><strong>@calculateRate &nbsp;</strong></span>
                            </span>
                            @for (int i = 0; i < calculateRate; i++)
                            {
                                <span style="color: #FFA500">★</span>
                            }
                            @for (int i = calculateRate; i < 5; i++)
                            {
                                <span style="color: #FFA500">☆</span>
                            }
                        </div>
                    </div>

                    <div class="mt-3">
                        Number of event(s) participated: &nbsp;<strong style="color: #FFA500">@Model.volunteersHistories.Count()</strong>
                    </div>
                    <div class="mt-3">
                        Number of skill(s): &nbsp;<strong style="color: #FFA500">@Model.volunteersSkills.Count()</strong>
                    </div>
                </div>

                <!-- Rank Skill Section with Dropdown next to the heading -->
                <div class="col-md-7">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">Ratings</h5>
                        <div class="form-group mb-0">
                            <select class="form-control" id="skillRankFilter" style="width: 200px;" onchange="filterSkills()">
                                <option value="Highest">Highest</option>
                                <option value="Lowest">Lowest</option>
                            </select>
                        </div>
                    </div>

                    <ul id="rankedSkillsList" class="list-group mt-3" style="max-height: 190px; overflow-y: auto;">
                        @foreach (var UserSkill in Model.volunteersSkills)
                        {
                            var skillName = Model.skills.Where(m => m.skillId == UserSkill.skillId).Select(m => m.skillName).FirstOrDefault();
                            var rating = Model.rating.Where(m => m.userId == UserSkill.userId && m.skillId == UserSkill.skillId).Select(m => m.rate).FirstOrDefault();

                            <li class="list-group-item skill-item" data-rating="@rating">
                                <strong>@Html.Raw(skillName)</strong> - @(rating > 0 ? $"{rating} stars" : "No rating available")
                                <div class="event-rating" style="color: #ffa500;">
                                    @if (rating.HasValue)
                                    {
                                        for (int i = 0; i < rating.Value; i++)
                                        {
                                            <span>★</span>
                                        }
                                        for (int i = rating.Value; i < 5; i++)
                                        {
                                            <span>☆</span>
                                        }
                                    }
                                    else
                                    {
                                        <span>No Rating</span>
                                    }
                                </div>
                            </li>
                        }
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
<br />
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script src="~/Content/Js2/profile.js"></script>
<script src="~/Content/Js2/rankskill.js"></script>